{% extends "base.html" %}

{% block content %}
<div class="row mb-5">
    <div class="col-12">
        <h3 class="h4 mb-4 border-bottom border-dark pb-2" style="letter-spacing: 2px;">THE ARCHIVE: HISTORICAL
            DISPATCHES</h3>
        <p class="small text-muted mb-5" style="font-family: var(--font-news);">Your private collection of narrated
            history, archived for priority transmission.</p>

        <div class="row g-5" id="news-container">
            {% if podcasts %}
            {% for podcast in podcasts %}
            <div class="col-md-12">
                <article class="broadsheet-card">
                    <div class="row">
                        <div class="col-md-8">
                            <span class="news-deck">{{ podcast.source }} &bull; {{ podcast.time[:10] if podcast.time
                                else 'Archived' }}</span>
                            <h2 class="fw-bold mb-3">{{ podcast.title }}</h2>

                            <!-- AI Dispatch Box -->
                            <div class="p-4 border border-dark mb-4"
                                style="background: rgba(0,0,0,0.03); font-family: var(--font-news);">
                                <h6 class="text-uppercase fw-bold mb-4 small border-bottom border-dark pb-2"
                                    style="letter-spacing: 2px;">Dispatch Summary</h6>

                                <div class="tldr-spotlight mb-4">
                                    <p class="fw-bold mb-0"
                                        style="font-family: var(--font-header); font-size: 1.2rem; line-height: 1.2;">{{
                                        podcast.tldr or 'Summary pending...' }}</p>
                                </div>

                                <p class="mb-4" style="line-height: 1.6;">{{ podcast.summary }}</p>

                                {% if podcast.key_points %}
                                <div class="mt-4 pt-3 border-top border-dark">
                                    <h6 class="text-uppercase fw-bold mb-3 small"
                                        style="font-family: var(--font-console);">Key Facts:</h6>
                                    <div class="key-points-list">
                                        {% for point in podcast.key_points %}
                                        <div class="key-point-item small">{{ point }}</div>
                                        {% endfor %}
                                    </div>
                                </div>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="radio-dashboard p-3">
                                <div class="small text-uppercase mb-2 fw-bold"
                                    style="font-family: var(--font-console); color: var(--dial-amber);">
                                    <i class="bi bi-play-circle"></i> REPLAY ARCHIVE
                                </div>
                                <div class="frequency-dial">
                                    <div class="dial-markings">
                                        <span>550</span><span>700</span><span>900</span><span>1200</span><span>1400</span><span>1700</span>
                                    </div>
                                    <div class="frequency-needle" id="needle-{{ podcast.ArticleID }}" style="left: 0%">
                                    </div>
                                </div>
                                <div class="player-controls mt-2">
                                    <button class="btn-play" id="play-btn-{{ podcast.ArticleID }}"
                                        onclick="togglePlay('{{ podcast.ArticleID }}')">
                                        <i class="bi bi-play-fill text-dark"></i>
                                    </button>
                                    <div class="player-status">
                                        <div class="progress-container"
                                            onclick="seek(event, '{{ podcast.ArticleID }}')">
                                            <div class="progress-bar" id="bar-{{ podcast.ArticleID }}"></div>
                                        </div>
                                    </div>
                                </div>
                                <audio id="audio-{{ podcast.ArticleID }}" src="{{ podcast.audio_url }}"
                                    ontimeupdate="updateProgress('{{ podcast.ArticleID }}')"></audio>
                            </div>
                        </div>
                    </div>
                </article>
            </div>
            {% endfor %}
            {% else %}
            <div class="col-12 text-center py-5">
                <div class="p-5 border border-dark border-dashed">
                    <i class="bi bi-mic display-1 text-muted mb-4 d-block"></i>
                    <h2 class="fw-bold">YOUR ARCHIVE IS EMPTY</h2>
                    <p class="text-muted" style="font-family: var(--font-news);">Tune into the live frequency to
                        generate your first dispatch.</p>
                    <a href="/dashboard" class="btn btn-primary mt-3 px-5 py-3">GO TO DASHBOARD</a>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}