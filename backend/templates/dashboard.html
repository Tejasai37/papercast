{% extends "base.html" %}

{% block content %}
<div class="row mb-5">
    <div class="col-12">
        <div class="command-console">
            <label class="console-label"><i class="bi bi-gear-wide-connected me-2"></i> Tuning Console</label>
            <form action="/dashboard" method="GET" id="consoleForm">
                <div class="console-input-group">
                    <input type="text" name="q" id="consoleInput" class="console-input"
                        placeholder="Enter Frequency (Keywords) or Paste Broadcast URL..."
                        value="{{ search_query or '' }}">
                    <button type="submit" class="console-btn">Tune In</button>
                </div>
            </form>
            <div class="d-flex justify-content-between align-items-end">
                <div class="console-knobs">
                    <div class="d-flex flex-column align-items-center">
                        <div class="knob"></div>
                        <span class="small mt-1"
                            style="font-family: var(--font-console); color: var(--radio-gold); font-size: 0.6rem;">GAIN</span>
                    </div>
                    <div class="d-flex flex-column align-items-center">
                        <div class="knob" style="transform: rotate(45deg);"></div>
                        <span class="small mt-1"
                            style="font-family: var(--font-console); color: var(--radio-gold); font-size: 0.6rem;">FREQ</span>
                    </div>
                </div>
                <div class="mt-3">
                    <div class="category-dial-container">
                        <span class="small text-white opacity-50 ms-2"
                            style="font-family: var(--font-console); font-size: 0.6rem;">TUNING:</span>
                        {% for cat in ['general', 'technology', 'business', 'entertainment', 'science', 'health'] %}
                        <a href="/dashboard?category={{ cat }}"
                            class="dial-option {% if current_category == cat %}active{% endif %}">
                            {{ cat }}
                        </a>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-12" style="max-width: 900px; margin: 0 auto;">
            <h3 class="h4 mb-4 border-bottom border-dark pb-2" style="letter-spacing: 2px;">LATEST DISPATCHES: {{
                current_category }}</h3>

            <div id="news-container" class="broadsheet-grid">
                {% for article in news %}
                <article class="broadsheet-card">
                    <span class="news-deck">{{ article.source }} &bull; {{ article.time[:10] }}</span>
                    <h2 class="fw-bold">{{ article.title }}</h2>
                    <div class="row">
                        <div class="col-md-11">
                            <p class="news-body">
                                <span class="drop-cap">{{ article.title[0] }}</span>
                                {{ article.content[:400] }}...
                            </p>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn-dial px-4 py-2" onclick="generateAudio('{{ article.id }}')">
                            <i class="bi bi-broadcast me-2"></i> START BROADCAST
                        </button>
                    </div>
                    <div id="player-{{ article.id }}" class="mt-4 d-none">
                        <!-- Radio Dashboard injected here -->
                    </div>
                </article>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        document.getElementById('consoleForm').onsubmit = function (e) {
            const input = document.getElementById('consoleInput').value.trim();
            if (input.startsWith('http')) {
                e.preventDefault();
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/api/process_link';
                const urlInput = document.createElement('input');
                urlInput.type = 'hidden';
                urlInput.name = 'url';
                urlInput.value = input;
                form.appendChild(urlInput);
                document.body.appendChild(form);
                form.submit();
            }
        };
    </script>
    {% endblock %}